@use "../conf/theme";

/**    _ _                 _
 *  __| (_)___ __ _ _ ___ | |_ ___
 * / _` | (_-</ _| '_/ -_)|  _/ _ \
 * \__,_|_/__/\__|_| \___(_)__\___/
 *
 * Copyright (c) 2022 - MIT License
 * Greg Deback <greg@discre.to>
 * <https://discre.to>
 *
 * Default theme layout
 */

/**
 * Popup layout
 */
#discreto {

  // Reset
  *, *:after, *:before {
    box-sizing:     border-box;
    vertical-align: initial;
  }

  // Font face
  font-family: theme.$fontFamily;
  font-size:   theme.$fontSize;
  font-weight: theme.$fontWeight;
  line-height: theme.$fontLineHeight;
  text-align:  left;

  p, ul, ol, dl, li, dt, dd, button, label {
    font-family: inherit;
    font-size:   inherit;
    font-weight: inherit;
    line-height: inherit;
    text-align:  inherit;
  }

  // Links
  a {
    font-weight:     theme.$linkWeight;
    text-decoration: theme.$linkDecoration;
    &, &:visited {
      color: theme.$linkColor;
    }
    &:hover, &:active {
      color: theme.$linkHover;
    }
  }

  // Strong
  strong {
    font-weight: theme.$fontBoldWeight;
    font-style:  normal;
  }
  em {
    font-weight: theme.$fontWeight;
    font-style:  italic;
  }

  // Overlay mask
  .overlay {
    position:   fixed;
    z-index:    1023;
    background: rgba(black, .4);
    bottom:     0;
    left:       0;
    // Disabled by default
    width:      0;
    height:     0;
    transition: width ease-in 10ms, height ease-in 10ms,
                background ease-in 2*theme.$delay 10ms;
  }
  &.block .overlay {
    // Enabled
    width:  100%;
    height: 100%;
  }
  &.min .overlay {
    // Hidden
    width:      0;
    height:     0;
    background: transparent;
    transition: width ease-out 10ms 2*theme.$delay, height ease-out 10ms 2*theme.$delay,
                background ease-out 2*theme.$delay;
  }

  // Popup
  .popup {

    // Fixed
    display:       flex;
    position:      fixed;
    z-index:       1024;
    left:          theme.$popupMaxOffset;
    bottom:        theme.$popupMaxOffset;
    width:         theme.$popupWidth;
    max-height:    95%;
    max-width:     90%;
    overflow:      hidden;
    background:    theme.$popupBack;
    color:         theme.$popupColor;
    border-radius: theme.$popupRadius;
    box-shadow:    theme.$popupShadow;
    transition:    all ease-in theme.$delay,
                   border-radius ease-in 2*theme.$delay theme.$delay,
                   max-width ease-in theme.$delay theme.$delay, max-height ease-in theme.$delay 2*theme.$delay;

    // Animated hat
    &:before,
    &:after {
      content:    "";
      position:   absolute;
      display:    block;
      cursor:     pointer;
      top:        theme.$hatOffset;
      right:      theme.$hatOffset;
      width:      theme.$hatSize;
      height:     theme.$hatSize;
      background: transparent no-repeat center/theme.$hatSize;
    }
    &:before {
      background-image: url('../img/glasses.png');
    }
    &:after {
      background-image: url('../img/hat.png');
      transform-origin: 80% 50%;
      transition:       all ease-in theme.$delay theme.$delay;
    }

  }

  // Right corner
  &.right .popup {
    left:  auto;
    right: theme.$popupMaxOffset;
    &:before,
    &:after {
      right: auto;
      left:  theme.$hatOffset;
    }
  }

  // Banner
  &.banner {
    .popup {
      width:         100%;
      max-width:     100%;
      border-radius: 0;
      left:          0;
      bottom:        0;
    }
    .consent {
      flex-direction:  row;
      align-items:     flex-end;
      justify-content: flex-end;
      flex-wrap:       wrap;
    }
    .main, .btns {
      min-width: theme.$popupMinWidth;
    }
    @media (min-width: 2*theme.$popupMinWidth) {
      .consent {
        padding-top: theme.$popupGutter+.5*theme.$fontSize;
      }
      .prefs {
        margin: 0;
      }
    }
  }
  &.show.banner {
    .popup {
      max-width:     90%;
      border-radius: theme.$popupRadius;
    }
    .consent {
      flex-direction: column;
      padding-top:    theme.$hatSize+theme.$popupGutter;
      align-items:    stretch;
    }
    .prefs {
      margin: 1em 0;
    }
    .btns {
      flex: 0 0 auto;
    }
  }

  // Centered
  &.show.banner .popup,
  &.center .popup,
  &.bottom .popup {
    left:      50%;
    transform: translate(-50%);
  }
  &.show.banner .popup,
  &.center .popup {
    bottom:    50%;
    transform: translate(-50%, 50%);
  }

  // Show
  &.show .popup {
    width: theme.$popupMaxWidth;
  }

  // Minified popup
  &.min .popup {
    opacity:       .5;
    overflow:      hidden;
    max-width:     theme.$hatOverall;
    max-height:    theme.$hatOverall;
    border-radius: theme.$hatRadius;
    left:          theme.$popupMinOffset;
    bottom:        theme.$popupMinOffset;
    transform:     translate(0, 0);
    transition:    all ease-out theme.$delay theme.$delay,
                   max-height ease-out theme.$delay, max-width ease-out theme.$delay theme.$delay,
                   border-radius ease-out 2*theme.$delay;
    &:hover {
      opacity: 1;
    }
  }

  // Hidden when minified
  &.min.autohide .popup {
    opacity: 0;
  }

  // Right corner
  &.min.right .popup {
    left:  auto;
    right: theme.$popupMinOffset;
  }
  &.min.autohide.right .popup {
    left:  auto;
    right: -(theme.$hatOverall);
  }

  // Cognition level
  &.cognito0 .popup:after {
    transform: translateY(1px);
  }
  &.cognito1 .popup:after {
    transform: translateY(0);
  }
  &.cognito2 .popup:after {
    transform: rotate(9deg);
  }
  &.cognito3 .popup:after {
    transform: rotate(18deg);
  }
  &.cognito4 .popup:after {
    transform: rotate(27deg);
  }
  &.cognito5 .popup:after {
    transform: rotate(36deg);
  }
  &.spring .popup:after {
    animation: spring theme.$delay alternate ease-in-out infinite;
  }
  @keyframes spring {
    0%   { transform: translateY(1px); }
    100% { transform: translateY(-2px) rotate(5deg); }
  }

  // Consent form
  .consent {

    margin:         0;
    width:          100%;
    padding:        theme.$hatSize+theme.$popupGutter 0 theme.$popupGutter;
    perspective:    600px;

    // Flex
    display:        flex;
    flex-direction: column;
    overflow:       hidden;

    // Fade in
    opacity:        1;
    transition:     opacity ease-in theme.$delay 2*theme.$delay;

  }

  // Main zone
  .main {

    // Flex
    flex:           1;
    display:        flex;
    flex-direction: column;
    overflow:       hidden;

  }

  // Fade out
  &.min .consent {
    opacity:    0;
    transition: opacity ease-out theme.$delay;
  }

  // Logo
  .logo {
    // Visible by default
    flex:       0 0 auto;
    opacity:    1;
    max-height: theme.$logoHeight+theme.$logoMargin;
    overflow:   hidden;
    transition: all ease-in theme.$delay;
    img {
      display:       block;
      margin-left:   theme.$popupGutter;
      width:         auto;
      height:        auto;
      max-height:    theme.$logoHeight;
      max-width:     80%;
      margin-bottom: 1em;
    }
  }

  // Hidden on prefs screen
  &.show .logo {
    opacity:    0;
    max-height: 0;
  }

  // Header
  .head {
    flex:    0 0 auto;
    margin:  0;
    padding: 0 theme.$popupGutter;
    p {
      margin: 0 0 .5em;
    }
  }

  // Preferences
  .prefs {

    // Flex
    flex:       1;
    transition: all ease-in theme.$delay;
    font-size:  theme.$fontPrefsSize;
    padding:    0 theme.$popupGutter;
    margin:     1em 0;

    // Collapsed by default
    opacity:    0;
    max-height: 0;
    overflow:   hidden;

    // Credits
    .credits {
      margin: 0;
    }

  }

  // Expanded & scrollable
  &.show .prefs {
    opacity:    1;
    overflow:   auto;
    max-height: 640px;
  }

  // Fieldset
  .field {
    margin:  1em 0;
    padding: 0;
    border:  none;
    legend {
      font-size:   theme.$legendSize;
      font-weight: theme.$legendWeight;
      color:       theme.$legendColor;
      margin:      0 0 .5em;
      padding:     0;
      border:      none;
    }
  }

  // Fieldset item
  .item {

    // Relative
    position:        relative;
    display:         flex;
    width:           100%;
    justify-content: space-between;
    align-items:     center;
    margin-bottom:   .5em;

    // Block label
    label {
      display:     block;
      margin:      0;
      padding:     0;
      font-weight: theme.$fontWeight;
      cursor:      pointer;
    }

    // Nice checkbox
    input {
      display: none;
      &:disabled + span {
        opacity: .5;
      }
      &:checked + span:after {
        left:         theme.$sliderWidth - theme.$checkWidth - theme.$checkOffset;
        background:   theme.$checkActive;
        border-color: theme.$checkActive;
      }
    }
    span {
      display:  block;
      position: relative;
      &:before {
        content:        "";
        display:        inline-block;
        width:          theme.$sliderWidth;
        height:         theme.$sliderHeight;
        border:         theme.$sliderBorder theme.$sliderColor solid;
        border-radius:  theme.$sliderRadius;
        vertical-align: bottom;
        margin-right:   1em;
      }
      &:after {
        content:       "";
        position:      absolute;
        width:         theme.$checkWidth;
        height:        theme.$checkHeight;
        background:    theme.$checkColor;
        border:        theme.$checkBorder theme.$checkColor solid;
        border-radius: theme.$checkRadius;
        left:          theme.$checkOffset;
        top:           50%;
        transform:     translateY(-50%);
        text-align:    center;
        font-size:     8px;
        line-height:   1;
        font-weight:   theme.$checkNewWeight;
        color:         theme.$checkNewColor;
        transition:    all ease-in theme.$delay;
      }
    }

    // Tooltip
    i {
      flex:          0 0 auto;
      cursor:        pointer;
      background:    theme.$tooltipBack;
      color:         theme.$tooltipColor;
      font-weight:   theme.$tooltipWeight;
      line-height:   1;
      margin-left:   1em;
      padding:       theme.$tooltipPadding;
      border-radius: theme.$tooltipRadius;
      font-size:     theme.$tooltipSize;
      font-style:    normal;
      text-align:    center;
      &.none {
        display: none;
      }
    }
    &.new {
      span:after {
        content: "+";
      }
      label {
        font-weight: theme.$tooltipNew;
      }
    }

  }

  // About box
  .info {

    margin:     .5em (-(theme.$popupGutter));
    padding:    0 theme.$popupGutter;
    background: theme.$listBack;
    color:      theme.$listColor;
    box-shadow: theme.$listShadow;

    // Expanded
    overflow:   auto;
    max-height: 100px;
    transition: margin ease-in theme.$delay,
                max-height ease-in theme.$delay;// $delay;

    // Collapsed
    &.rolled {
      overflow:   hidden;
      max-height: 0;
      margin:     0 (-(theme.$popupGutter));
      transition: max-height ease-out theme.$delay,
                  margin ease-out theme.$delay;// $delay;
    }

    // Container
    div {
      margin: 1em 0;
    }
    p {
      margin: 0 0 .5em;
    }

    // Lists
    ul {
      margin:     0;
      padding:    0;
      list-style: square inside;
      li {
        margin:  0;
        padding: 0;
        &:before {
          display: none;
        }
      }
    }

    // Small
    small {
      font-size: .9em;
    }

    // Misusage warning
    &.misuse {
      background: theme.$alertBack;
      color:      theme.$alertColor;
    }

  }

  // Buttons
  .btns {

    flex:            0 0 auto;
    position:        relative;
    text-align:      right;
    transform-style: preserve-3d;
    height:          theme.$buttonHeight;
    transition:      height ease-in theme.$delay;
    @media (max-width: theme.$popupWidth+20px) {
      height: 2*theme.$buttonHeight+theme.$buttonMargin;
      .front button:nth-child(3) {
        border-top-right-radius:    theme.$buttonRadius;
        border-bottom-right-radius: theme.$buttonRadius;
      }
      .front button:nth-child(4) {
        border-top-left-radius:    theme.$buttonRadius;
        border-bottom-left-radius: theme.$buttonRadius;
      }
    }

    // Flip
    div {
      position:            absolute;
      top:                 0;
      right:               0;
      width:               100%;
      padding:             0 theme.$popupGutter;
      transition:          all ease-in 2*theme.$delay theme.$delay;
      -webkit-backface-visibility: hidden;
      -moz-backface-visibility: hidden;
      backface-visibility: hidden;
      &.back {
        transform: rotateX(180deg);
      }
    }

    // Button
    button {
      cursor:      pointer;
      font-weight: theme.$buttonWeight;
      font-size:   theme.$buttonSize;
      background:  theme.$buttonBack;
      color:       theme.$buttonColor;
      margin:      0 0 theme.$buttonMargin;
      padding:     theme.$buttonPadding;
      box-shadow:  theme.$buttonShadow;
      border:      none;
      transition:  all ease-in theme.$delay;
      &:first-child {
        border-top-left-radius:    theme.$buttonRadius;
        border-bottom-left-radius: theme.$buttonRadius;
      }
      &:last-child {
        border-top-right-radius:    theme.$buttonRadius;
        border-bottom-right-radius: theme.$buttonRadius;
        font-weight: theme.$buttonOkWeight;
        color:       theme.$buttonMainColor;
        background:  theme.$buttonMainBack;
      }
      &:hover, &:active {
        box-shadow: none;
        background: theme.$buttonColor;
        color:      theme.$buttonBack;
      }
    }

  }

  // Flap
  &.show .btns {
    @media (max-width: theme.$popupWidth+20px) {
      height: theme.$buttonHeight;
    }
    div.back {
      transform: rotateX(0);
    }
    div.front {
      transform: rotateX(-180deg);
    }
  }

  // Hidden iframes
  .noscript {
    width:      0;
    height:     0;
    display:    none !important;
    visibility: hidden !important;
  }

}
